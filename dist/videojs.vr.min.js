/*! videojs-vr - v0.1.0 - 2014-03-26
* Copyright (c) 2014 Sean Lawrence; Licensed  */
THREE.PointerLockControls=THREE.PointerLockControls||function(a){var b=this,c=new THREE.Object3D;c.add(a);var d=new THREE.Object3D;d.position.y=10,d.add(c);var e=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=new THREE.Vector3,l=Math.PI/2,m=function(a){if(b.enabled!==!1){var e=a.movementX||a.mozMovementX||a.webkitMovementX||0,f=a.movementY||a.mozMovementY||a.webkitMovementY||0;d.rotation.y-=.002*e,c.rotation.x-=.002*f,c.rotation.x=Math.max(-l,Math.min(l,c.rotation.x))}},n=function(a){switch(a.keyCode){case 38:case 87:e=!0;break;case 37:case 65:g=!0;break;case 40:case 83:f=!0;break;case 39:case 68:h=!0;break;case 32:j===!0&&(k.y+=10),j=!1}},o=function(a){switch(a.keyCode){case 38:case 87:e=!1;break;case 37:case 65:g=!1;break;case 40:case 83:f=!1;break;case 39:case 68:h=!1}};document.addEventListener("mousemove",m,!1),document.addEventListener("keydown",n,!1),document.addEventListener("keyup",o,!1),this.enabled=!1,this.getObject=function(){return d},this.isOnObject=function(a){i=a,j=a},this.update=function(a){b.enabled!==!1&&(a*=.1,k.x+=.08*-k.x*a,k.z+=.08*-k.z*a,k.y-=.25*a,e&&(k.z-=.12*a),f&&(k.z+=.12*a),g&&(k.x-=.12*a),h&&(k.x+=.12*a),i===!0&&(k.y=Math.max(0,k.y)),d.translateX(k.x),d.translateY(k.y),d.translateZ(k.z),d.position.y<10&&(k.y=0,d.position.y=10,j=!0))}},function(a){var b=function(a){var b,c,d;for(c=1;c<arguments.length;c++){b=arguments[c];for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}return a},c=function(a,b,c){var d=document,e="pointerLockElement"in d||"mozPointerLockElement"in d||"webkitPointerLockElement"in d,f=d.body;if(e){var g=function(){d.pointerLockElement===f||d.mozPointerLockElement===f||d.webkitPointerLockElement===f?a():b()},h=function(){b()};d.addEventListener("pointerlockchange",g,!1),d.addEventListener("mozpointerlockchange",g,!1),d.addEventListener("webkitpointerlockchange",g,!1),d.addEventListener("pointerlockerror",h,!1),d.addEventListener("mozpointerlockerror",h,!1),d.addEventListener("webkitpointerlockerror",h,!1),c.addEventListener("click",function(){if(f.requestPointerLock=f.requestPointerLock||f.mozRequestPointerLock||f.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var a=function(){(d.fullscreenElement===f||d.mozFullscreenElement===f||d.mozFullScreenElement===f)&&(d.removeEventListener("fullscreenchange",a),d.removeEventListener("mozfullscreenchange",a),f.requestPointerLock())};d.addEventListener("fullscreenchange",a,!1),d.addEventListener("mozfullscreenchange",a,!1),f.requestFullscreen=f.requestFullscreen||f.mozRequestFullscreen||f.mozRequestFullScreen||f.webkitRequestFullscreen,f.requestFullscreen()}else f.requestPointerLock()},!1)}else b("Your browser doesn't seem to support Pointer Lock API")},d=["Sphere","Cube","Plane"],e={projection:"Plane"},f=function(f){function g(){o.getObject().position.set(0,0,0),o.getObject().rotation.y=0,o.getObject().children[0].rotation.x=0}function h(a){var b={x:0,y:0,z:0};p&&p.remove(n),"Sphere"===a?m=new THREE.SphereGeometry(256,32,32):"Cube"===a?m=new THREE.CubeGeometry(256,256,256):"Plane"===a&&(m=new THREE.PlaneGeometry(480,204,4,4),b.z=-256),n=new THREE.Mesh(m,l),n.position.set(b.x,b.y,b.z),g(),p.add(n)}function i(){function a(){if(t.readyState===t.HAVE_ENOUGH_DATA&&d&&(d.needsUpdate=!0),s){e=vr.requestAnimationFrame(m);var a=vr.pollState(k);o.update(Date.now()-j,a?k:null),b.render(p,g,a?k:null)}else e=window.requestAnimationFrame(m),o.update(Date.now()-j),f.render(p,g);j=Date.now()}var b,d,e,f,g,i,j=Date.now(),k=s?new vr.State:null;g=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e3),p=new THREE.Scene,o=s?new THREE.OculusRiftControls(g):new THREE.PointerLockControls(g),p.add(o.getObject()),d=new THREE.Texture(t),d.minFilter=THREE.LinearFilter,d.magFilter=THREE.LinearFilter,l=new THREE.MeshBasicMaterial({map:d,overdraw:!0,side:THREE.DoubleSide}),h(v),g.position.set(0,0,0),f=new THREE.WebGLRenderer({devicePixelRatio:1,alpha:!1,clearColor:16777215,antialias:!0}),f.setSize(1024,768),s&&(b=new THREE.OculusRiftEffect(f)),i=f.domElement,i.style.width="inherit",i.style.height="inherit",u.insertBefore(i,u.firstChild),t.style.display="none";var m=a.bind(this);m(),s||c(function(){o.enabled=!0},function(){o.enabled=!1},u.getElementsByTagName("canvas")[0])}function j(){a.ProjectionSelector=a.MenuButton.extend({init:function(b,c){b.availableProjections=c.availableProjections||[],a.MenuButton.call(this,b,c)}}),a.ProjectionTitleMenuItem=a.MenuItem.extend({init:function(b,c){a.MenuItem.call(this,b,c),this.off("click")}}),a.ProjectionMenuItem=a.MenuItem.extend({init:function(b,c){c.label=c.res,c.selected=c.res.toString()===b.getCurrentRes().toString(),a.MenuItem.call(this,b,c),this.resolution=c.res,this.on("click",this.onClick),b.on("changeProjection",a.bind(this,function(){this.selected(this.resolution===b.getCurrentRes()?!0:!1)}))}}),a.ProjectionMenuItem.prototype.onClick=function(){var a=this.player(),b=a.controlBar.projectionSelection.el().firstChild.children,c=b.length;for(h(this.resolution);c>0;)if(c--,"vjs-current-res"===b[c].className){b[c].innerHTML=this.resolution;break}},a.ProjectionSelector.prototype.createItems=function(){var b=this.player(),c=[];return c.push(new a.ProjectionTitleMenuItem(b,{el:a.Component.prototype.createEl("li",{className:"vjs-menu-title vjs-res-menu-title",innerHTML:"Projections"})})),b.availableProjections.forEach(function(d){c.push(new a.ProjectionMenuItem(b,{res:d}))}),c}}function k(){q.getCurrentRes=function(){return q.current_proj||""};var b=new a.ProjectionSelector(q,{el:a.Component.prototype.createEl(null,{className:"vjs-res-button vjs-menu-button vjs-control",innerHTML:'<div class="vjs-control-content"><span class="vjs-current-res">'+(v||"Projections")+"</span></div>",role:"button","aria-live":"polite",tabIndex:0}),availableProjections:d});q.controlBar.projectionSelection=q.controlBar.addChild(b)}var l,m,n,o,p,q=this,r=b({},e,f||{}),s=!1,t=this.el().getElementsByTagName("video")[0],u=this.el(),v=r.projection;i(),j(),k()};a.plugin("vr",f)}(window.videojs);